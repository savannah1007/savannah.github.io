<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>first-blog | Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta name="description" content="序号 02        桂林电子科技大学2023-2024学年第3学期  *网络渗透测试技术* 实验报告    实验名称 *实验六*  指导意见：  成绩：               指导教师：       姓   名 陈霖汕 学  号 2300360102      专   业 网络空间安全        实验日期 2024 年 7 月 8 日            *一、实验目的*">
<meta property="og:type" content="article">
<meta property="og:title" content="first-blog">
<meta property="og:url" content="http://example.com/2024/08/23/first-blog/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="序号 02        桂林电子科技大学2023-2024学年第3学期  *网络渗透测试技术* 实验报告    实验名称 *实验六*  指导意见：  成绩：               指导教师：       姓   名 陈霖汕 学  号 2300360102      专   业 网络空间安全        实验日期 2024 年 7 月 8 日            *一、实验目的*">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="file:///C:/Users/savannah/AppData/Local/Temp/ksohtml32092/wps1.jpg">
<meta property="og:image" content="file:///C:/Users/savannah/AppData/Local/Temp/ksohtml32092/wps2.jpg">
<meta property="og:image" content="file:///C:/Users/savannah/AppData/Local/Temp/ksohtml32092/wps3.jpg">
<meta property="og:image" content="file:///C:/Users/savannah/AppData/Local/Temp/ksohtml32092/wps4.jpg">
<meta property="og:image" content="file:///C:/Users/savannah/AppData/Local/Temp/ksohtml32092/wps5.jpg">
<meta property="og:image" content="file:///C:/Users/savannah/AppData/Local/Temp/ksohtml32092/wps6.jpg">
<meta property="og:image" content="file:///C:/Users/savannah/AppData/Local/Temp/ksohtml32092/wps7.jpg">
<meta property="og:image" content="file:///C:/Users/savannah/AppData/Local/Temp/ksohtml32092/wps8.jpg">
<meta property="og:image" content="file:///C:/Users/savannah/AppData/Local/Temp/ksohtml32092/wps9.jpg">
<meta property="og:image" content="file:///C:/Users/savannah/AppData/Local/Temp/ksohtml32092/wps10.jpg">
<meta property="og:image" content="file:///C:/Users/savannah/AppData/Local/Temp/ksohtml32092/wps11.jpg">
<meta property="og:image" content="file:///C:/Users/savannah/AppData/Local/Temp/ksohtml32092/wps12.jpg">
<meta property="og:image" content="file:///C:/Users/savannah/AppData/Local/Temp/ksohtml32092/wps13.jpg">
<meta property="og:image" content="file:///C:/Users/savannah/AppData/Local/Temp/ksohtml32092/wps14.jpg">
<meta property="og:image" content="file:///C:/Users/savannah/AppData/Local/Temp/ksohtml32092/wps15.jpg">
<meta property="og:image" content="file:///C:/Users/savannah/AppData/Local/Temp/ksohtml32092/wps16.jpg">
<meta property="og:image" content="file:///C:/Users/savannah/AppData/Local/Temp/ksohtml32092/wps17.jpg">
<meta property="og:image" content="file:///C:/Users/savannah/AppData/Local/Temp/ksohtml32092/wps18.jpg">
<meta property="og:image" content="file:///C:/Users/savannah/AppData/Local/Temp/ksohtml32092/wps19.jpg">
<meta property="og:image" content="file:///C:/Users/savannah/AppData/Local/Temp/ksohtml32092/wps20.jpg">
<meta property="og:image" content="file:///C:/Users/savannah/AppData/Local/Temp/ksohtml32092/wps21.jpg">
<meta property="og:image" content="file:///C:/Users/savannah/AppData/Local/Temp/ksohtml32092/wps22.jpg">
<meta property="og:image" content="file:///C:/Users/savannah/AppData/Local/Temp/ksohtml32092/wps23.jpg">
<meta property="og:image" content="file:///C:/Users/savannah/AppData/Local/Temp/ksohtml32092/wps24.jpg">
<meta property="og:image" content="file:///C:/Users/savannah/AppData/Local/Temp/ksohtml32092/wps25.jpg">
<meta property="og:image" content="file:///C:/Users/savannah/AppData/Local/Temp/ksohtml32092/wps26.jpg">
<meta property="article:published_time" content="2024-08-23T00:34:19.000Z">
<meta property="article:modified_time" content="2024-08-23T01:40:07.635Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="渗透测试实验6">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="file:///C:/Users/savannah/AppData/Local/Temp/ksohtml32092/wps1.jpg">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
  
<meta name="generator" content="Hexo 7.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"><span class="fa fa-bars"></span></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
        
          <a class="nav-icon" href="/atom.xml" title="RSS Feed"><span class="fa fa-rss"></span></a>
        
        <a class="nav-icon nav-search-btn" title="Search"><span class="fa fa-search"></span></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-first-blog" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2024/08/23/first-blog/" class="article-date">
  <time class="dt-published" datetime="2024-08-23T00:34:19.000Z" itemprop="datePublished">2024-08-23</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="p-name article-title" itemprop="headline name">
      first-blog
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <table>
<thead>
<tr>
<th>序号</th>
<th>02</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>桂林电子科技大学2023-2024学年第3学期</p>
<p> <em><strong>*网络渗透测试技术*</strong></em> 实验报告</p>
<table>
<thead>
<tr>
<th>实验名称</th>
<th><em><strong>*实验六*</strong></em></th>
<th></th>
<th>指导意见：  成绩：               指导教师：</th>
<th></th>
<th></th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>姓   名</td>
<td>陈霖汕</td>
<td>学  号</td>
<td>2300360102</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>专   业</td>
<td>网络空间安全</td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>实验日期</td>
<td>2024</td>
<td>年</td>
<td>7</td>
<td>月</td>
<td>8</td>
<td>日</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<p><em><strong>*一、实验目的*</strong></em></p>
<p>（1）理解权限维持技术的实现机制；</p>
<p>（2）掌握相应的防御技术和方法，提升安全防护能力；</p>
<p>（3）掌握权限维持技术和入侵痕迹清理方法。<em><strong>*二、实验任务*</strong></em></p>
<p><em><strong>*三、实验环境*</strong></em></p>
<p>1、靶机地址（win7）：192.168.135.150</p>
<p>Win2008：192.168.138.138</p>
<p>2、攻击机地址：192.168.135.127</p>
<p><em><strong>*四、实验过程和实验结果*</strong></em></p>
<ol>
<li>首先将靶机和攻击机设为同一个网段，再使用sudo arp-scan -l命令查询在同一网段的ip地址</li>
</ol>
<p><img src="file:///C:\Users\savannah\AppData\Local\Temp\ksohtml32092\wps1.jpg" alt="img"> </p>
<ol start="2">
<li>通过测试和观察发现，ip为192.168.135.150为靶机，在火狐中打开能够得到网页</li>
</ol>
<p><img src="file:///C:\Users\savannah\AppData\Local\Temp\ksohtml32092\wps2.jpg" alt="img"> </p>
<ol start="3">
<li>使用disearch扫描网站目录，查找后缀为php的文件，发现文件名为add.php文件的较为可疑，打开文件查看源码之后没有找到什么有用的线索</li>
</ol>
<p><img src="file:///C:\Users\savannah\AppData\Local\Temp\ksohtml32092\wps3.jpg" alt="img"> </p>
<p><img src="file:///C:\Users\savannah\AppData\Local\Temp\ksohtml32092\wps4.jpg" alt="img"> </p>
<ol start="4">
<li>不过我们能在之前的页面注意到ThinkPHP V5.0.22{十年磨一剑-为API开发设计的高性能框架},通过查询我们能够得到ThinkPHP V5.0.22存在远程代码执行漏洞</li>
</ol>
<p><img src="file:///C:\Users\savannah\AppData\Local\Temp\ksohtml32092\wps5.jpg" alt="img"> </p>
<ol start="5">
<li>查找漏洞得到，逐一尝试，在第四个页面中打开php页面</li>
</ol>
<p><img src="file:///C:\Users\savannah\AppData\Local\Temp\ksohtml32092\wps6.jpg" alt="img"> </p>
<p><img src="file:///C:\Users\savannah\AppData\Local\Temp\ksohtml32092\wps7.jpg" alt="img"> </p>
<ol start="6">
<li>上传一个webshell，该URL利用漏洞来进行远程代码执行，执行任意系统命令</li>
</ol>
<p><img src="file:///C:\Users\savannah\AppData\Local\Temp\ksohtml32092\wps8.jpg" alt="img"> </p>
<ol start="7">
<li>使用dir打开该网页目录，能够看到新加进去的shell.php和原有的add.php</li>
</ol>
<p><img src="file:///C:\Users\savannah\AppData\Local\Temp\ksohtml32092\wps9.jpg" alt="img"> </p>
<ol start="8">
<li>使用蚁剑连接网址<a target="_blank" rel="noopener" href="http://192.168.135.150/shell.php,%E6%89%93%E5%BC%80add.php%EF%BC%8C%E5%BE%97%E5%88%B0password">http://192.168.135.150/shell.php,打开add.php，得到password</a></li>
</ol>
<p><img src="file:///C:\Users\savannah\AppData\Local\Temp\ksohtml32092\wps10.jpg" alt="img"> </p>
<p><img src="file:///C:\Users\savannah\AppData\Local\Temp\ksohtml32092\wps11.jpg" alt="img"> </p>
<ol start="9">
<li>将password解码得到密码为admins，登录成功</li>
</ol>
<p><img src="file:///C:\Users\savannah\AppData\Local\Temp\ksohtml32092\wps12.jpg" alt="img"> </p>
<p><img src="file:///C:\Users\savannah\AppData\Local\Temp\ksohtml32092\wps13.jpg" alt="img"> </p>
<ol start="10">
<li>使用工具msf生成木马，根据生成内容我们能够看出生成的是powshell.exe，在蚁剑中打开终端执行</li>
</ol>
<p><img src="file:///C:\Users\savannah\AppData\Local\Temp\ksohtml32092\wps14.jpg" alt="img"> </p>
<p><img src="file:///C:\Users\savannah\AppData\Local\Temp\ksohtml32092\wps15.jpg" alt="img"> </p>
<p><em><strong>*在蚁剑中确认蚁剑所连的ip地址为192.168.138.136*</strong></em></p>
<p><img src="file:///C:\Users\savannah\AppData\Local\Temp\ksohtml32092\wps16.jpg" alt="img"> </p>
<p><em><strong>*执行成功之后的kali页面*</strong></em></p>
<p><img src="file:///C:\Users\savannah\AppData\Local\Temp\ksohtml32092\wps17.jpg" alt="img"> </p>
<p><strong>11.</strong> <em><strong>*cs上线，将生成的木马放在win7phpstudy的目录下，使用蚁剑连接到win7中，能够看到木马已经被植入，在终端中执行木马，cs成功上线，我们能够看到win7现在是以管理员身份运行的*</strong></em></p>
<p><img src="file:///C:\Users\savannah\AppData\Local\Temp\ksohtml32092\wps18.jpg" alt="img"> </p>
<p><strong>12.</strong> <em><strong>*输入shell，反弹权限，在kali中得到win7的权限，开始信息收集*</strong></em></p>
<p><img src="file:///C:\Users\savannah\AppData\Local\Temp\ksohtml32092\wps19.jpg" alt="img"> </p>
<p><em><strong>*发现内网网段138，域名为sun.com*</strong></em></p>
<p><strong>13.</strong> <em><strong>*使用内网穿透工具EW，本实验使用反向连接，即使用win7连接kali*</strong></em></p>
<p><em><strong>*首先在kali中将端口1090提出的请求转发到2233端口，在win7中执行，开启socks服务，访问kali的2233端口就可以进行kali的socks服务*</strong></em></p>
<p><img src="file:///C:\Users\savannah\AppData\Local\Temp\ksohtml32092\wps20.jpg" alt="img"> </p>
<p><img src="file:///C:\Users\savannah\AppData\Local\Temp\ksohtml32092\wps21.jpg" alt="img"> </p>
<p><strong>14.</strong> <em><strong>*下一步开始域控渗透*</strong></em></p>
<p><em><strong>*返回meterpreter模块中，使用msf中的mimikatz模块抓取密码*</strong></em></p>
<p><img src="file:///C:\Users\savannah\AppData\Local\Temp\ksohtml32092\wps22.jpg" alt="img"> </p>
<p><em><strong>*这里出现了报错，原因是因为mimikatz是32位的，无法访问64位的，关于mimikatz的详细论述在后文会详细阐述，所以将它迁移到64位*</strong></em></p>
<p><em><strong>*Ps命令：用于显示目标系统上当前运行的经常列表，类似于Linux系统中的ps命令。*</strong></em></p>
<p><em><strong>*Migrate 348命令：将当前的meterpreter命令会话迁移到目标系统上的进程id位348的经常中，选择csrss.exe的原因是：进程中出现了两个csrss.exe，既有可能是恶意软件伪装的进程，这里将powshell.exe进程给到348的进程*</strong></em></p>
<p><img src="file:///C:\Users\savannah\AppData\Local\Temp\ksohtml32092\wps23.jpg" alt="img"> </p>
<p><em><strong>*拿到域管理员的用户名和密码*</strong></em></p>
<p><strong>15.</strong> <em><strong>*利用Psexec登录域控*</strong></em></p>
<p><strong>16.</strong> <em><strong>*由于使用的是nat模式，无法利用域控登录，故先使用cs提权*</strong></em></p>
<p><img src="file:///C:\Users\savannah\AppData\Local\Temp\ksohtml32092\wps24.jpg" alt="img"> </p>
<p><em><strong>*提权为system*</strong></em></p>
<p><em><strong>*在cs中新建一个监听器，生成一个Windows.exe可执行文件，在蚁剑中放入win7中*</strong></em></p>
<p><img src="file:///C:\Users\savannah\AppData\Local\Temp\ksohtml32092\wps25.jpg" alt="img"> </p>
<p><em><strong>*PsExec64.exe*</strong></em><em><strong>*：允许在远程系统上执行进程*</strong></em></p>
<p><strong>17.</strong> <em><strong>*上线即可*</strong></em></p>
<p><img src="file:///C:\Users\savannah\AppData\Local\Temp\ksohtml32092\wps26.jpg" alt="img"> </p>
<p><em><strong>*五、实验总结*</strong></em></p>
<ol>
<li>searchsploit thinkphp用于在Exploit-DB 数据库中搜索与ThinkPHP相关的漏洞，这条命令会返回所有包含”Thinkphp”关键词的漏洞信息，包括漏洞的描述、路径等详细信息。</li>
<li>横向渗透：攻击者获得内网某台积极的控制权，例如本实验中获得win7的权限，以该机器为跳板，通过收集域内凭证等方法，访问域内的其他机器，扩大攻击范围。</li>
</ol>
<p>横向渗透步骤（msf探测）：</p>
<p>IPC：实现进程间通信开放，ipc通过验证用户名和密码获得相应的权限，前提需要管理员开启默认共享。命令：net share ipc$</p>
<ol start="3">
<li>域控渗透：利用漏洞或者工具攻击域控制器，获取域内的敏感信息或者权限，思路：通过域成员主机，定位出域控制器ip及管理员账号，利用域成员主机作为跳板，扩大渗透范围</li>
</ol>
<p>常用命令：ipconfig &#x2F;all 查看本机ip,all表示查看所在域</p>
<p>Route print 打印路由信息</p>
<p>Net view 查看其他局域网内其他主机名</p>
<p>Net share 查看开启了哪些共享</p>
<p>Net share c$ 开启c盘共享</p>
<p>Net user 查看本机用户列表</p>
<p>Net user &#x2F;domain 查看域用户</p>
<p>Net group &#x2F;domain 查看与里面的工作组，查看把用户分了多少组</p>
<ol start="4">
<li>内网穿透工具ew（全名EarthWorm）：可以正向连接和反向连接</li>
</ol>
<p>运行命令：</p>
<p>正向连接:在kali攻击机中.&#x2F;ew_for_linux64 -s lcx_tran -l 8888 -f 192.168.135.150 -g 3389，该命令意思是将目标服务器的3389端口转发到攻击机的8888端口，访问攻击机的8888端口就可以连接目标服务器的3389端口</p>
<p>反向连接：在kali攻击机中.&#x2F;ew_for_linux64 -s rcsocks -l 1008 -e 8888，该命令意思是将端口1008提出的请求转发到8888端口，在目标机器上输入ew_for_Win.exe -s rssocks 192.168.135.150 -e 8888,该命令意识是开启socks服务，访问192.168.135.150的8888端口就可以跟目标机器进行互通。</p>
<ol start="5">
<li>在本次实验中我实在msf中使用的PsExec，故讲述在msf中的使用方法（在cs中也可以实现）：</li>
</ol>
<p>添加路由：run get_local_subnets</p>
<p>​     Run autoroute -s ip地址&#x2F;24</p>
<p>​     Run autoroute -p</p>
<p>加载模块：设置目标ip，账号，密码，payload</p>
<p>最后执行就能成功获得域的session</p>
<ol start="6">
<li>提权方法：提权的方法有两种，一种是在kali中通过msf提权，另外一种是使用cs提权</li>
</ol>
<p>方法一（msf提权）：</p>
<p>常用命令：sysinfo 查看系统命令</p>
<p> Migrate 注入进程</p>
<p> Getuid 获取当前用户</p>
<p> Getsystem 通过各种攻击向量来提升系统用户权限</p>
<p> Ps 列出进程</p>
<p> Sessions 查看会话</p>
<p>方法二（cs提权）：</p>
<p>1.1. Bypassuac：将中级管理员权限提到高级管理员权限</p>
<p>1.2. Elevate（最常用）：将任意用户的权限提升至系统权限</p>
<p>1.3. Getsystem：将高级管理员权限提升至系统权限</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2024/08/23/first-blog/" data-id="cm061odlm0000j4odfvsshuj0" data-title="first-blog" class="article-share-link"><span class="fa fa-share">Share</span></a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E5%AE%9E%E9%AA%8C6/" rel="tag">渗透测试实验6</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/2024/08/22/hello-world/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Hello World</div>
    </a>
  
</nav>

  
</article>


</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E5%AE%9E%E9%AA%8C6/" rel="tag">渗透测试实验6</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/%E6%B8%97%E9%80%8F%E6%B5%8B%E8%AF%95%E5%AE%9E%E9%AA%8C6/" style="font-size: 10px;">渗透测试实验6</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2024/08/">August 2024</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2024/08/23/first-blog/">first-blog</a>
          </li>
        
          <li>
            <a href="/2024/08/22/hello-world/">Hello World</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2024 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.6.4.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>